var Picture={transformOriginal:function(a,b,c){b.onload=function(){a.canvas.width=window.innerWidth,a.canvas.height=window.innerHeight,a.drawImage(b,0,0,a.canvas.width,a.canvas.height);var c=a.getImageData(0,0,a.canvas.width,a.canvas.height),d=Picture.setDuotone(c);Picture.currentImageData=d,a.putImageData(d,0,0)},b.crossOrigin="Anonymous",b.src=c},setDuotone:function(a){for(var b=0;b<a.data.length;b+=4){var c=Pixel.brightness(a.data[b],a.data[b+1],a.data[b+2]),d=c/255,e=1-d,f=[d*ComplementaryColors.color1[0],0,0],g=[0,e*ComplementaryColors.color2[1],0],h=ComplementaryColors.duotoneColorRgb(f,g);a.data[b]=h[0],a.data[b+1]=h[1],a.data[b+2]=h[2]}var i=Array.prototype.slice.call(a.data);return Picture.duotoneImageDataArray=new Uint8ClampedArray(i),a},transition:function(a,b,c){var d=ComplementaryColors.color1,e=ComplementaryColors.color2,f=d[0]/e[1];switch(a){case"dark":for(var g=0;g<Picture.currentImageData.data.length;g+=4)Picture.currentImageData.data[g]+=f,Picture.currentImageData.data[g+1]-=f;b.putImageData(Picture.currentImageData,0,0);break;case"duotone":for(var g=0;g<Picture.currentImageData.data.length;g+=4)Picture.currentImageData.data[g]===Picture.duotoneImageDataArray[g]&&Picture.currentImageData.data[g+1]===Picture.duotoneImageDataArray[g+1]||(Picture.currentImageData.data[g]>Picture.duotoneImageDataArray[g]?Picture.currentImageData.data[g]-=f:Picture.currentImageData.data[g]<Picture.duotoneImageDataArray[g]&&(Picture.currentImageData.data[g]+=f),Picture.currentImageData.data[g+1]>Picture.duotoneImageDataArray[g+1]?Picture.currentImageData.data[g+1]-=f:Picture.currentImageData.data[g+1]<Picture.duotoneImageDataArray[g+1]&&(Picture.currentImageData.data[g+1]+=f));b.putImageData(Picture.currentImageData,0,0)}}},ComplementaryColors={setColors:function(a,b){ComplementaryColors.color1=a,ComplementaryColors.color2=b},duotoneColorRgb:function(a,b){var c=[];for(var d in a){var e=a[d]+b[d];c.push(e)}return c}},Pixel={brightness:function(a,b,c){var d=(a+b+c)/3;return d}},Keyboard={checkKey:function(a,b,c){a.preventDefault(),39==a.keyCode?Picture.transition("dark",b,c):37==a.keyCode&&Picture.transition("duotone",b,c)}};$(document).ready(function(a){var b=a("#palm-img").attr("src"),c=document.getElementById("palm-canvas"),d=c.getContext("2d"),e=new Image;ComplementaryColors.setColors([255,0,0],[0,128,0]),Picture.transformOriginal(d,e,b),document.addEventListener("keydown",function(a){Keyboard.checkKey(a,d,c)})});